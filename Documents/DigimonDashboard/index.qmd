---
title: "Digimon Dashboard"
author: "Karl Matias"
format:
  dashboard:
    orientation: rows
    vertical-layout: fill
execute:
  echo: false
  warning: false
  message: false
---

```{r, echo=FALSE}
library(tidyverse)
library(plotly)
library(janitor)
```

```{r}
digimon <- read_delim("Digimon.csv.xls", delim = ";") %>%
  clean_names()

digimon <- digimon |>
  rename(
    name      = any_of(c("digimon","name")),
    stage     = any_of(c("stage")),
    type      = any_of(c("type")),
    attribute = any_of(c("attribute")),
    atk_lvl_99 = any_of(c("atk_lvl_99","atk","attack")),
    def_lvl_99 = any_of(c("def_lvl_99","def","defense")),
    int_lvl_99 = any_of(c("int_lvl_99","int","intelligence")),
    spd_lvl_99 = any_of(c("spd_lvl_99","spd","speed"))
  )

num_cols <- c("atk_lvl_99","def_lvl_99","int_lvl_99","spd_lvl_99")
for (c in intersect(num_cols, names(digimon))) {
  digimon[[c]] <- suppressWarnings(as.numeric(digimon[[c]]))
}
```

## Row 1

```{r}
n_digi <- nrow(digimon)
avg_atk <- if("atk_lvl_99" %in% names(digimon)) round(mean(digimon$atk_lvl_99, na.rm=TRUE)) else NA
avg_spd <- if("spd_lvl_99" %in% names(digimon)) round(mean(digimon$spd_lvl_99, na.rm=TRUE)) else NA
cat("Total Digimon:", n_digi)
cat(" \nAvg ATK (lvl 99):", avg_atk)
cat(" \nAvg SPD (lvl 99):", avg_spd)
```

```{r, warning=FALSE}
p1 <- ggplot(digimon, aes(x = atk_lvl_99, y = spd_lvl_99, color = attribute, text = digimon)) +
  geom_point(size = 3) +
  labs(
    x = "Attack (Lvl 99)",
    y = "Speed (Lvl 99)",
    color = "Attribute"
  ) +
  theme_bw()

ggplotly(p1, tooltip = c("text", "color"))

```

## Row 2 {.tabset}

```{r, warning=FALSE}
# Bar Chart: Top Attack Power (Level 99)

b1 <- digimon %>%
  mutate(
    atk_lvl_99 = as.numeric(atk_lvl_99),              # ensure numeric
    name = forcats::fct_reorder(name, atk_lvl_99)     # order bars by attack
  ) %>%
  ggplot(aes(x = name, y = atk_lvl_99, text = name)) +
  geom_col(fill = "purple") +  # cleaner than geom_bar(stat="identity")
  labs(
    title = "Top Attack Power (Level 99)",
    x = "Digimon",
    y = "Attack (Lvl 99)"
  ) +
  theme_bw() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold", size = 14)
  )

ggplotly(b1, tooltip = "text")

```

```{r}
#| title: Table
digimon_table <- digimon %>%
  select(name, stage, type, attribute, atk_lvl_99, def_lvl_99, int_lvl_99, spd_lvl_99)

knitr::kable(digimon_table, caption = "Digimon Stats Overview")
```

# Page 2

## Row 1
